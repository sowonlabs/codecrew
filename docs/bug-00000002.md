# Bug #00000002: Claude CLI v2.0 Breaking Changes

## ê¸°ë³¸ ì •ë³´
- **ID**: bug-00000002
- **ìš°ì„ ìˆœìœ„**: ê¸´ê¸‰
- **ìƒíƒœ**: resolved
- **ì‘ì„±ì**: GitHub Copilot
- **ì‘ì—…ì**: dohapark
- **ìƒì„±ì¼**: 2025-10-03 19:15:00
- **ìˆ˜ì •ì¼**: 2025-10-03 19:45:00

## í˜„ìƒ

### Slack Bot ì‹¤íŒ¨
Slack Botì—ì„œ Claude ì—ì´ì „íŠ¸ë¥¼ í˜¸ì¶œí•˜ë©´ ë¹ˆ ì‘ë‹µë§Œ ë°˜í™˜ë˜ê³  ì¦‰ì‹œ ì‹¤íŒ¨í•©ë‹ˆë‹¤.

**ì—ëŸ¬ ë¡œê·¸:**
```
[Nest] 60819  - 10/03/2025, 7:15:05 PM     LOG [ClaudeProvider] Executing claude with prompt (length: 3732)
ğŸ”§ DEBUG: Response content type: string
ğŸ”§ DEBUG: Response content (first 500 chars): 
[ë¹ˆ ì‘ë‹µ]
[Nest] 60819  - 10/03/2025, 7:15:05 PM   DEBUG [TaskManagementService] Added log to task task_1759486504978_vmooovzaz: [INFO] Query completed. Success: false
[Nest] 60819  - 10/03/2025, 7:15:05 PM     LOG [TaskManagementService] Task task_1759486504978_vmooovzaz failed in 140ms
```

### ì¦ìƒ
- Claude CLI ì‹¤í–‰ ì‹œ ë¹ˆ ì‘ë‹µ
- 140ms ë§Œì— ì¦‰ì‹œ ì‹¤íŒ¨ (ì •ìƒ ì‘ë‹µ ì‹œê°„ë³´ë‹¤ í›¨ì”¬ ì§§ìŒ)
- ëª¨ë“  Claude ê´€ë ¨ query/execute ëª…ë ¹ì–´ ì‘ë™ ë¶ˆê°€
- Slack, CLI, MCP ëª¨ë“  ì¸í„°í˜ì´ìŠ¤ì—ì„œ ë™ì¼í•œ ë¬¸ì œ ë°œìƒ

## í™˜ê²½
- **OS**: macOS
- **Claude CLI**: v2.0.5 (ì—…ê·¸ë ˆì´ë“œ: 2025-10-03 13:45)
- **CodeCrew**: v0.3.5
- **Node.js**: v20.19.2
- **ì„¤ì¹˜ ê²½ë¡œ**: `/Users/doha/.nvm/versions/node/v20.19.2/bin/claude`

## ì›ì¸

### Timeline
| ë‚ ì§œ | ì´ë²¤íŠ¸ |
|------|--------|
| 2025-09-29 14:41 | Claude CLI v2.0.0 ë¦´ë¦¬ì¦ˆ (MAJOR VERSION) |
| 2025-10-02 16:20 | Claude CLI v2.0.5 ë¦´ë¦¬ì¦ˆ |
| 2025-10-03 13:45 | ì‚¬ìš©ìê°€ v2.0.5ë¡œ ì—…ê·¸ë ˆì´ë“œ |
| 2025-10-03 19:15 | Slack Botì—ì„œ ë²„ê·¸ ë°œê²¬ (6ì‹œê°„ í›„) |

### Claude CLI v2.0 Breaking Changes

#### 1. `-p` í”Œë˜ê·¸ ì˜ë¯¸ ë³€ê²½ (CRITICAL!)

**Before (v1.x):**
```bash
claude -p "Your prompt text here"
# -p ë‹¤ìŒì— í”„ë¡¬í”„íŠ¸ í…ìŠ¤íŠ¸ ì „ë‹¬
```

**After (v2.x):**
```bash
claude -p                    # --print mode (print and exit)
echo "prompt" | claude -p    # stdinìœ¼ë¡œ ì…ë ¥ ë°›ìŒ
```

#### 2. í”Œë˜ê·¸ ìˆœì„œ ì˜ì¡´ì„±

**âŒ ì‘ë™ ì•ˆí•¨:**
```bash
claude --output-format stream-json --verbose -p
# Error: When using --print, --output-format=stream-json requires --verbose
```

**âœ… ì‘ë™:**
```bash
claude -p --verbose --output-format stream-json
# ì˜¬ë°”ë¥¸ ìˆœì„œ: -pê°€ ë§¨ ì•, ê·¸ ë‹¤ìŒ --verbose, ë§ˆì§€ë§‰ì— --output-format
```

#### 3. `--verbose` í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

`--output-format=stream-json`ì„ ì‚¬ìš©í•˜ë ¤ë©´ **ë°˜ë“œì‹œ `--verbose` í”Œë˜ê·¸ê°€ í•„ìš”**í•©ë‹ˆë‹¤.

### ê¸°ì¡´ ì½”ë“œì˜ ë¬¸ì œ

**íŒŒì¼:** `src/providers/claude.provider.ts`

```typescript
protected getDefaultArgs(): string[] {
  return ['--output-format', 'stream-json', '--verbose', '-p'];
}
```

**ë¬¸ì œì :**
1. í”Œë˜ê·¸ ìˆœì„œê°€ ì˜ëª»ë¨ (`-p`ê°€ ë§¨ ë’¤)
2. `--verbose`ê°€ `--output-format`ë³´ë‹¤ ë’¤ì— ìˆìŒ
3. v2.0ì—ì„œ `-p`ì˜ ì˜ë¯¸ê°€ ë³€ê²½ë˜ì—ˆëŠ”ë° v1.x ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©

## í•´ê²°ì±…

### ì½”ë“œ ìˆ˜ì •

**íŒŒì¼:** `src/providers/claude.provider.ts`

```typescript
// ìˆ˜ì • ì „ (v1.x í˜¸í™˜)
protected getDefaultArgs(): string[] {
  return ['--output-format', 'stream-json', '--verbose', '-p'];
}

protected getExecuteArgs(): string[] {
  return ['--output-format', 'stream-json', '--verbose', '-p'];
}

// ìˆ˜ì • í›„ (v2.x í˜¸í™˜)
protected getDefaultArgs(): string[] {
  // Claude CLI v2.0+ requires -p first, then --verbose, then --output-format
  return ['-p', '--verbose', '--output-format', 'stream-json'];
}

protected getExecuteArgs(): string[] {
  // Claude CLI v2.0+ requires -p first, then --verbose, then --output-format
  return ['-p', '--verbose', '--output-format', 'stream-json'];
}
```

### í…ŒìŠ¤íŠ¸

#### 1. ìˆ˜ë™ CLI í…ŒìŠ¤íŠ¸
```bash
# ì˜ëª»ëœ ìˆœì„œ (ì‹¤íŒ¨)
echo "Say hello" | claude --output-format stream-json --verbose -p
# ê²°ê³¼: Error: When using --print, --output-format=stream-json requires --verbose

# ì˜¬ë°”ë¥¸ ìˆœì„œ (ì„±ê³µ)
echo "Say hello in Korean" | claude -p --verbose --output-format stream-json
# ê²°ê³¼: {"type":"assistant","message":{"content":[{"type":"text","text":"ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹"}]}}
```

#### 2. CodeCrew CLI í…ŒìŠ¤íŠ¸
```bash
node dist/main.js query "@claude Say hi in Korean" --raw
# ê²°ê³¼: ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹
```

#### 3. Slack Bot í…ŒìŠ¤íŠ¸
```
@CodeCrew gugudan1.js íŒŒì¼ì— êµ¬êµ¬ë‹¨ ìë°”ìŠ¤í¬ë¦½íŠ¸ í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•´ì£¼ì„¸ìš”
# ê²°ê³¼: ì •ìƒ ì‘ë‹µ ë° íŒŒì¼ ìƒì„±
```

## ì˜í–¥ ë²”ìœ„

### ì˜í–¥ë°›ëŠ” ì»´í¬ë„ŒíŠ¸
- âœ… **Claude Provider**: ìˆ˜ì • ì™„ë£Œ
- âœ… **Slack Bot**: Claude ì—ì´ì „íŠ¸ í˜¸ì¶œ ì •ìƒí™”
- âœ… **CLI**: query/execute ëª…ë ¹ì–´ ì •ìƒí™”
- âœ… **MCP Server**: tool í˜¸ì¶œ ì •ìƒí™”

### ì˜í–¥ë°›ì§€ ì•ŠëŠ” ì»´í¬ë„ŒíŠ¸
- âœ… **Copilot Provider**: v0.0.330 (í”Œë˜ê·¸ ìµœì†Œ ì‚¬ìš©)
- âœ… **Gemini Provider**: v0.6.1 (í”Œë˜ê·¸ ìµœì†Œ ì‚¬ìš©)

## ì˜ˆë°©ì±…

### 1. ë²„ì „ í•€ë‹
`package.json` ë˜ëŠ” ë¬¸ì„œì—ì„œ Claude CLI ë²„ì „ ëª…ì‹œ:
```bash
npm install -g @anthropic-ai/claude-code@2.0.5
```

### 2. ë²„ì „ ê°ì§€
í–¥í›„ v1.xì™€ v2.xë¥¼ ë™ì‹œ ì§€ì›í•˜ë ¤ë©´ ë²„ì „ ê°ì§€ ë¡œì§ ì¶”ê°€:
```typescript
async detectClaudeVersion(): Promise<'v1' | 'v2'> {
  const version = await execSync('claude --version').toString();
  return version.startsWith('2.') ? 'v2' : 'v1';
}
```

### 3. CI/CD í…ŒìŠ¤íŠ¸
ë‹¤ì–‘í•œ Claude CLI ë²„ì „ì— ëŒ€í•œ integration test ì¶”ê°€

### 4. ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ
READMEì— Claude CLI v2.x ë§ˆì´ê·¸ë ˆì´ì…˜ ì•ˆë‚´ ì¶”ê°€

## ê´€ë ¨ íŒŒì¼
- `src/providers/claude.provider.ts` - ìˆ˜ì •ëœ íŒŒì¼
- `CLAUDE_V2_BREAKING_CHANGES.md` - ìƒì„¸ breaking changes ë¬¸ì„œ
- `bug.md` - ë²„ê·¸ íŠ¸ë˜í‚¹

## êµí›ˆ
ë©”ì´ì € ë²„ì „ ì—…ë°ì´íŠ¸(v1 â†’ v2)ëŠ” í•­ìƒ breaking changesë¥¼ ë™ë°˜í•©ë‹ˆë‹¤.
CLI ë„êµ¬ì˜ ì—…ë°ì´íŠ¸ í›„ì—ëŠ” **ë°˜ë“œì‹œ integration test**ë¥¼ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.

## ì°¸ê³  ìë£Œ
- Claude CLI v2.0.0 Release: https://www.npmjs.com/package/@anthropic-ai/claude-code/v/2.0.0
- Claude CLI ê³µì‹ ë¬¸ì„œ: https://claude.ai/download
- CodeCrew Issue: Slack Bot Claude integration failure

---

**Status**: âœ… Resolved  
**Next Action**: ì‚¬ìš©ìê°€ Slack Bot ì¬ì‹œì‘ í›„ ìµœì¢… í™•ì¸ â†’ closed ìƒíƒœë¡œ ì „í™˜
